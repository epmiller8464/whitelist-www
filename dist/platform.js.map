{"version":3,"sources":["../platform.js"],"names":["cors","require","express","exphbs","path","csurf","configurePlatform","platform","disable","set","use","engine","join","__dirname","cookie","authenticate","index","req","res","next","locals","_csrfToken","csrfToken","user","err","Error","status","message","error","app","get","render","module","exports"],"mappings":"AAAA;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,SAASF,QAAQ,cAAR,EAAwB,SAAxB,CAAf;AACA,IAAMG,OAAOH,QAAQ,MAAR,CAAb;AACA,IAAMI,QAAQJ,QAAQ,OAAR,CAAd;;AAEA,SAASK,iBAAT,GAA8B;AAC5B,MAAIC,WAAWL,SAAf;AACAK,WAASC,OAAT,CAAiB,cAAjB;AACAD,WAASE,GAAT,CAAa,aAAb,EAA4B,CAA5B;AACAF,WAASG,GAAT,CAAaV,MAAb;AACA;AACAO,WAASI,MAAT,CAAgB,KAAhB,EAAuBR,OAAOQ,MAA9B;AACAJ,WAASE,GAAT,CAAa,OAAb,EAAsBL,KAAKQ,IAAL,CAAUC,SAAV,EAAqB,OAArB,CAAtB;AACAN,WAASE,GAAT,CAAa,aAAb,EAA4B,KAA5B;AACAF,WAASG,GAAT,CAAaL,MAAM,EAACS,QAAQ,IAAT,EAAN,CAAb;;AAEA,MAAIC,eAAed,QAAQ,oBAAR,CAAnB;AACA,MAAMe,QAAQf,QAAQ,yBAAR,CAAd;AACAM,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUO,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAClDD,QAAIE,MAAJ,CAAWC,UAAX,GAAwBJ,IAAIK,SAAJ,EAAxB;AACAJ,QAAIE,MAAJ,CAAWG,IAAX,GAAkB,EAACA,MAAMN,IAAIM,IAAX,EAAlB;AACAJ;AACD,GAJD;AAKAZ,WAASG,GAAT,CAAa,WAAb,EAA0BM,KAA1B;;AAEAT,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUO,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAClD,QAAIK,MAAM,IAAIC,KAAJ,CAAU,WAAV,CAAV;AACAD,QAAIE,MAAJ,GAAa,GAAb;AACAP,SAAKK,GAAL;AACD,GAJD;;AAMF;AACEjB,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUc,GAAV,EAAeP,GAAf,EAAoBC,GAApB,EAAyBC,IAAzB,EAA+B;AACvD;AACAD,QAAIE,MAAJ,CAAWO,OAAX,GAAqBH,IAAIG,OAAzB;AACAT,QAAIE,MAAJ,CAAWQ,KAAX,GAAmBX,IAAIY,GAAJ,CAAQC,GAAR,CAAY,KAAZ,MAAuB,aAAvB,GAAuCN,GAAvC,GAA6C,EAAhE;;AAEA;AACAN,QAAIQ,MAAJ,CAAWF,IAAIE,MAAJ,IAAc,GAAzB;AACAR,QAAIa,MAAJ,CAAW,OAAX;AACD,GARD;;AAUA,SAAOxB,QAAP;AACD;;AAEDyB,OAAOC,OAAP,GAAiB3B,iBAAjB","file":"platform.js","sourcesContent":["'use strict'\nconst cors = require('cors')\nconst express = require('express')\nconst exphbs = require('./handlebars')('inverse')\nconst path = require('path')\nconst csurf = require('csurf')\n\nfunction configurePlatform () {\n  var platform = express()\n  platform.disable('x-powered-by')\n  platform.set('trust proxy', 1)\n  platform.use(cors())\n  // alternate view engine\n  platform.engine('hbs', exphbs.engine)\n  platform.set('views', path.join(__dirname, 'views'))\n  platform.set('view engine', 'hbs')\n  platform.use(csurf({cookie: true}))\n\n  let authenticate = require('./lib/authenticate')\n  const index = require('./routes/platform/index')\n  platform.use('/platform', function (req, res, next) {\n    res.locals._csrfToken = req.csrfToken()\n    res.locals.user = {user: req.user}\n    next()\n  })\n  platform.use('/platform', index)\n\n  platform.use('/platform', function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    next(err)\n  })\n\n// error handler\n  platform.use('/platform', function (err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message\n    res.locals.error = req.app.get('env') === 'development' ? err : {}\n\n    // render the error page\n    res.status(err.status || 500)\n    res.render('error')\n  })\n\n  return platform\n}\n\nmodule.exports = configurePlatform"]}