{"version":3,"sources":["../platform.js"],"names":["cors","require","express","csurf","viewConfig","util","configurePlatform","platform","disable","set","use","authenticate","req","res","next","locals","_csrfToken","csrfToken","user","err","Error","status","message","error","app","get","redirect","module","exports"],"mappings":"AAAA;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;AACA,IAAMG,aAAaH,QAAQ,mBAAR,CAAnB;AACA,IAAMI,OAAOJ,QAAQ,MAAR,CAAb;;AAEA,SAASK,iBAAT,GAA8B;AAC5B,MAAMC,WAAWL,SAAjB;AACAK,WAASC,OAAT,CAAiB,cAAjB;AACAD,WAASE,GAAT,CAAa,aAAb,EAA4B,CAA5B;AACAF,WAASG,GAAT,CAAaV,MAAb;AACAI,aAAWG,QAAX,EAAqB,SAArB;AACAA,WAASG,GAAT,CAAaP,OAAb;;AAEA,MAAIQ,eAAeV,QAAQ,oBAAR,CAAnB;AACAM,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUE,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAClDD,QAAIE,MAAJ,CAAWC,UAAX,GAAwBJ,IAAIK,SAAJ,EAAxB;AACAJ,QAAIE,MAAJ,CAAWG,IAAX,GAAkB,EAACA,MAAMN,IAAIM,IAAX,EAAlB;AACAJ;AACD,GAJD;AAKAP,WAASG,GAAT,CAAa,WAAb,EAA0BC,YAA1B,EAAwCV,QAAQ,yBAAR,CAAxC;AACAM,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUE,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAClD,QAAIK,MAAM,IAAIC,KAAJ,CAAU,WAAV,CAAV;AACAD,QAAIE,MAAJ,GAAa,GAAb;AACAP,SAAKK,GAAL;AACD,GAJD;AAKF;AACEZ,WAASG,GAAT,CAAa,WAAb,EAA0B,UAAUS,GAAV,EAAeP,GAAf,EAAoBC,GAApB,EAAyBC,IAAzB,EAA+B;AACvD;AACAD,QAAIE,MAAJ,CAAWO,OAAX,GAAqBH,IAAIG,OAAzB;AACAT,QAAIE,MAAJ,CAAWQ,KAAX,GAAmBX,IAAIY,GAAJ,CAAQC,GAAR,CAAY,KAAZ,MAAuB,aAAvB,GAAuCN,GAAvC,GAA6C,EAAhE;AACA;AACA;AACA;AACAN,QAAIa,QAAJ,CAAa,QAAb;AACD,GARD;;AAUA,SAAOnB,QAAP;AACD;;AAEDoB,OAAOC,OAAP,GAAiBtB,iBAAjB","file":"platform.js","sourcesContent":["'use strict'\nconst cors = require('cors')\nconst express = require('express')\nconst csurf = require('csurf')\nconst viewConfig = require('./lib/setup/views')\nconst util = require('util')\n\nfunction configurePlatform () {\n  const platform = express()\n  platform.disable('x-powered-by')\n  platform.set('trust proxy', 1)\n  platform.use(cors())\n  viewConfig(platform, 'inverse')\n  platform.use(csurf())\n\n  let authenticate = require('./lib/authenticate')\n  platform.use('/platform', function (req, res, next) {\n    res.locals._csrfToken = req.csrfToken()\n    res.locals.user = {user: req.user}\n    next()\n  })\n  platform.use('/platform', authenticate, require('./routes/platform/index'))\n  platform.use('/platform', function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    next(err)\n  })\n// error handler\n  platform.use('/platform', function (err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message\n    res.locals.error = req.app.get('env') === 'development' ? err : {}\n    // render the error page\n    // res.status(err.status || 500)\n    // res.render('error')\n    res.redirect('/error')\n  })\n\n  return platform\n}\n\nmodule.exports = configurePlatform\n"]}