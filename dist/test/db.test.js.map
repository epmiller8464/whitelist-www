{"version":3,"sources":["../../test/db.test.js"],"names":["process","env","NODE_ENV","require","config","faker","Whitelist","uuid","DateTime","confirmEmailToken","verifyToken","test","done","dt","local","wl","email","internet","firstName","name","lastName","ip","purchaseAmount","cryptoType","country","token","jwt","v4","timeZone","ts","zoneName","offset","save","error","doc","expect","toBe","id","then","updates","$set","update","_id","new","err","toBeNull","console","log","toObject","catch"],"mappings":"AAAA;;AACAA,QAAQC,GAAR,CAAYC,QAAZ,GAAuB,aAAvB;AACAC,QAAQ,QAAR,EAAkBC,MAAlB;AACA,IAAMC,QAAQF,QAAQ,OAAR,CAAd;AACAA,QAAQ,WAAR,EAAqB,YAAM,CAAE,CAA7B;;eACoBA,QAAQ,cAAR,C;IAAbG,S,YAAAA,S;;AACP,IAAMC,OAAOJ,QAAQ,MAAR,CAAb;;gBACmBA,QAAQ,OAAR,C;IAAZK,Q,aAAAA,Q;;gBACkCL,QAAQ,qBAAR,C;IAAlCM,iB,aAAAA,iB;IAAmBC,W,aAAAA,W;;AAE1B;;;AACAC,KAAK,WAAL,EAAkB,UAACC,IAAD,EAAU;AAC1B,MAAIC,KAAKL,SAASM,KAAT,EAAT;;AAEA,MAAIC,KAAK,IAAIT,SAAJ,CAAc;AACrBU,WAAOX,MAAMY,QAAN,CAAeD,KAAf,EADc;AAErBE,eAAW,UAAUb,MAAMc,IAAN,CAAWD,SAAX,EAFA;AAGrBE,cAAU,UAAUf,MAAMc,IAAN,CAAWC,QAAX,EAHC;AAIrBC,QAAIhB,MAAMY,QAAN,CAAeI,EAAf,EAJiB;AAKrBC,oBAAgB,WALK;AAMrBC,gBAAY,KANS;AAOrBC,aAAS,IAPY;AAQrBC,WAAO;AACLC,WAAKnB,KAAKoB,EAAL;AADA,KARc;AAarBC,cAAU;AACRC,UAAIhB,GAAGgB,EADC;AAERC,gBAAUjB,GAAGiB,QAFL;AAGRC,cAAQlB,GAAGkB;AAHH;AAbW,GAAd,CAAT;;AAoBAhB,KAAGiB,IAAH,CAAQ,UAACC,KAAD,EAAQC,GAAR,EAAgB;AACtBC,WAAOF,KAAP,EAAcG,IAAd,CAAmB,IAAnB;AACA;AACA3B,sBAAkByB,IAAIG,EAAtB,EACCC,IADD,CACM,UAACb,KAAD,EAAW;AACf,UAAIc,UAAU,EAACC,MAAM,EAAC,aAAaf,KAAd,EAAP,EAAd;;AAEAnB,gBAAUmC,MAAV,CAAiB,EAACC,KAAKR,IAAIG,EAAV,EAAjB,EAAgCE,OAAhC,EAAyC,EAACI,KAAK,IAAN,EAAzC,EAAsD,UAACC,GAAD,EAAMV,GAAN,EAAc;AAClEC,eAAOS,GAAP,EAAYC,QAAZ;AACAC,gBAAQC,GAAR,CAAYb,IAAIc,QAAJ,EAAZ;AACApC;AACD,OAJD;AAKD,KATD,EASGqC,KATH,CASS,UAACL,GAAD,EAAS;AAChBT,aAAOS,GAAP,EAAYC,QAAZ;AACAjC;AACD,KAZD;AAaD,GAhBD;AAiBD,CAxCD","file":"db.test.js","sourcesContent":["'use strict'\nprocess.env.NODE_ENV = 'development'\nrequire('dotenv').config()\nconst faker = require('faker')\nrequire('../lib/db')(() => {})\nconst {Whitelist} = require('../lib/model')\nconst uuid = require('uuid')\nconst {DateTime} = require('luxon')\nconst {confirmEmailToken, verifyToken} = require('../lib/jsonwebtoken')\n\n// let db = DB()\ntest('whitelist', (done) => {\n  let dt = DateTime.local()\n\n  var wl = new Whitelist({\n    email: faker.internet.email(),\n    firstName: 'fake-' + faker.name.firstName(),\n    lastName: 'fake-' + faker.name.lastName(),\n    ip: faker.internet.ip(),\n    purchaseAmount: '1000-5000',\n    cryptoType: 'ETH',\n    country: 'US',\n    token: {\n      jwt: uuid.v4(),\n      // blackListed: {type: Boolean, default: false},\n      // revoked: {type: Boolean, default: false}\n    },\n    timeZone: {\n      ts: dt.ts,\n      zoneName: dt.zoneName,\n      offset: dt.offset\n    }\n  })\n\n  wl.save((error, doc) => {\n    expect(error).toBe(null)\n    // expect(doc).toBeGreaterThan(0)\n    confirmEmailToken(doc.id)\n    .then((token) => {\n      let updates = {$set: {'token.jwt': token}}\n\n      Whitelist.update({_id: doc.id}, updates, {new: true}, (err, doc) => {\n        expect(err).toBeNull()\n        console.log(doc.toObject())\n        done()\n      })\n    }).catch((err) => {\n      expect(err).toBeNull()\n      done()\n    })\n  })\n})\n"]}