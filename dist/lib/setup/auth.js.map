{"version":3,"sources":["../../../lib/setup/auth.js"],"names":["jwt","require","User","login","req","res","next","findOne","email","body","error","user","status","send","success","message","comparePassword","password","matches","token","sign","process","env","APP_SECRET","json","Api","verify","headers","authorization","split","length","module","exports"],"mappings":"AAAA;;AACA,IAAMA,MAAMC,QAAQ,cAAR,CAAZ;;eACeA,QAAQ,SAAR,C;IAARC,I,YAAAA,I;;AAEP,IAAMC,QAAQ,SAARA,KAAQ,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChCJ,OAAKK,OAAL,CAAa,EAACC,OAAOJ,IAAIK,IAAJ,CAASD,KAAjB,EAAb,EAAsC,UAACE,KAAD,EAAQC,IAAR,EAAiB;AACrD,QAAID,KAAJ,EAAW;AACT,aAAOJ,KAAKI,KAAL,CAAP;AACD;AACD,QAAI,CAACC,IAAL,EAAW;AACTN,UAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,KAAV,EAAiBC,SAAS,wCAA1B,EAArB;AACD,KAFD,MAEO;AACLJ,WAAKK,eAAL,CAAqBZ,IAAIK,IAAJ,CAASQ,QAA9B,EAAwC,UAACP,KAAD,EAAQQ,OAAR,EAAoB;AAC1D,YAAIA,WAAW,CAACR,KAAhB,EAAuB;AACrB,cAAMS,QAAQnB,IAAIoB,IAAJ,CAAS,EAACT,UAAD,EAAT,EAAiBU,QAAQC,GAAR,CAAYC,UAA7B,CAAd;AACAlB,cAAImB,IAAJ,CAAS,EAACV,SAAS,IAAV,EAAgBC,SAAS,eAAzB,EAA0CI,YAA1C,EAAT;AACD,SAHD,MAGO;AACLd,cAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,KAAV,EAAiBC,SAAS,wCAA1B,EAArB;AACD;AACF,OAPD;AAQD;AACF,GAhBD;AAiBD,CAlBD;;AAoBAU,IAAIC,MAAJ,GAAa,UAACC,OAAD,EAAa;AACxB,MAAIA,WAAWA,QAAQC,aAAvB,EAAsC;AACpC,QAAMC,QAAQF,QAAQC,aAAR,CAAsBC,KAAtB,CAA4B,GAA5B,CAAd;AACA,QAAIA,MAAMC,MAAN,KAAiB,CAArB,EAAwB,OAAOD,MAAM,CAAN,CAAP,CAAxB,KACK,OAAO,IAAP;AACN,GAJD,MAIO,OAAO,IAAP;AACR,CAND;;AAQAE,OAAOC,OAAP,GAAiB,EAACP,QAAD,EAAjB","file":"auth.js","sourcesContent":["'use strict'\nconst jwt = require('jsonwebtoken')\nconst {User} = require('./model')\n\nconst login = (req, res, next) => {\n  User.findOne({email: req.body.email}, (error, user) => {\n    if (error) {\n      return next(error)\n    }\n    if (!user) {\n      res.status(401).send({success: false, message: 'Authentication failed. User not found.'})\n    } else {\n      user.comparePassword(req.body.password, (error, matches) => {\n        if (matches && !error) {\n          const token = jwt.sign({user}, process.env.APP_SECRET)\n          res.json({success: true, message: 'Token granted', token})\n        } else {\n          res.status(401).send({success: false, message: 'Authentication failed. Wrong password.'})\n        }\n      })\n    }\n  })\n}\n\nApi.verify = (headers) => {\n  if (headers && headers.authorization) {\n    const split = headers.authorization.split(' ')\n    if (split.length === 2) return split[1]\n    else return null\n  } else return null\n}\n\nmodule.exports = {Api}\n"]}