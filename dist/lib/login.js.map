{"version":3,"sources":["../../lib/login.js"],"names":["jwt","require","User","login","req","res","next","findOne","email","body","error","user","status","json","success","message","comparePassword","password","matches","jwtOpts","expiresIn","token","sign","process","env","APP_SECRET","Error","module","exports"],"mappings":"AAAA;;AACA,IAAMA,MAAMC,QAAQ,cAAR,CAAZ;;eACeA,QAAQ,SAAR,C;IAARC,I,YAAAA,I;;AACP,IAAMC,QAAQ,SAARA,KAAQ,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChCJ,OAAKK,OAAL,CAAa,EAACC,OAAOJ,IAAIK,IAAJ,CAASD,KAAjB,EAAb,EAAsC,UAACE,KAAD,EAAQC,IAAR,EAAiB;AACrD,QAAID,KAAJ,EAAW;AACT,aAAOJ,KAAKI,KAAL,CAAP;AACD;AACD,QAAI,CAACC,IAAL,EAAW;AACTN,UAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,KAAV,EAAiBC,SAAS,cAA1B,EAArB;AACD,KAFD,MAEO;AACLJ,WAAKK,eAAL,CAAqBZ,IAAIK,IAAJ,CAASQ,QAA9B,EAAwC,UAACP,KAAD,EAAQQ,OAAR,EAAoB;AAC1D,YAAIA,WAAW,CAACR,KAAhB,EAAuB;AACrB,cAAIS,UAAU;AACZC;AADY,WAAd;AAGA,cAAMC,QAAQrB,IAAIsB,IAAJ,CAAS,EAACX,UAAD,EAAT,EAAiBY,QAAQC,GAAR,CAAYC,UAA7B,EAAyCN,OAAzC,CAAd;;AAEAd,cAAIQ,IAAJ,CAAS,EAACC,SAAS,IAAV,EAAT;AACD,SAPD,MAOO;AACLR,eAAK,IAAIoB,KAAJ,CAAU,cAAV,CAAL;AACArB,cAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,KAAV,EAAiBC,SAAS,wCAA1B,EAArB;AACD;AACF,OAZD;AAaD;AACF,GArBD;AAsBD,CAvBD;;AAyBAY,OAAOC,OAAP,GAAiB,EAACzB,YAAD,EAAjB","file":"login.js","sourcesContent":["'use strict'\nconst jwt = require('jsonwebtoken')\nconst {User} = require('./model')\nconst login = (req, res, next) => {\n  User.findOne({email: req.body.email}, (error, user) => {\n    if (error) {\n      return next(error)\n    }\n    if (!user) {\n      res.status(401).json({success: false, message: 'Unauthorized'})\n    } else {\n      user.comparePassword(req.body.password, (error, matches) => {\n        if (matches && !error) {\n          let jwtOpts = {\n            expiresIn: `1d`\n          }\n          const token = jwt.sign({user}, process.env.APP_SECRET, jwtOpts)\n\n          res.json({success: true})\n        } else {\n          next(new Error('Unauthorized'))\n          res.status(401).json({success: false, message: 'Authentication failed. Wrong password.'})\n        }\n      })\n    }\n  })\n}\n\nmodule.exports = {login}\n"]}