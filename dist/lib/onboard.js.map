{"version":3,"sources":["../../lib/onboard.js"],"names":["require","Email","Whitelist","confirmEmailToken","verifyToken","onBoard","data","cb","console","log","record","email","ip","cryptoType","purchaseAmount","timeZone","save","err","doc","error","message","id","then","token","sendConfirmation","to","result","updates","$set","update","_id","new","toObject","confirmEmail","Business","resendVerifyEmail","context","module","exports"],"mappings":"AAAA;;eACgBA,QAAQ,QAAR,C;IAATC,K,YAAAA,K;;gBACaD,QAAQ,cAAR,C;IAAbE,S,aAAAA,S;;gBACkCF,QAAQ,gBAAR,C;IAAlCG,iB,aAAAA,iB;IAAmBC,W,aAAAA,W;;AAE1B,SAASC,OAAT,CAAkBC,IAAlB,EAAwBC,EAAxB,EAA4B;AAC1BC,UAAQC,GAAR,CAAY,YAAZ;AACAF,OAAKA,MAAM,YAAY,CAAE,CAAzB;AACA;AACA;AACA,MAAIG,SAAS,IAAIR,SAAJ,CAAc;AACzBS,WAAOL,KAAKK,KADa;AAEzBC,QAAIN,KAAKM,EAFgB;AAGzBC,gBAAYP,KAAKO,UAHQ;AAIzBC,oBAAgBR,KAAKQ,cAJI;AAKzBC,cAAUT,KAAKS;;AALU,GAAd,CAAb;AAQAL,SAAOM,IAAP,CAAY,UAACC,GAAD,EAAMC,GAAN,EAAc;AACxB,QAAID,GAAJ,EAAS;AACPT,cAAQW,KAAR,CAAcF,IAAIG,OAAlB;AACA,aAAOb,GAAGU,GAAH,CAAP;AACD;AACD;AACAd,sBAAkBe,IAAIG,EAAtB,EAA0BC,IAA1B,CAA+B,UAACC,KAAD,EAAW;AACxC;AACAtB,YAAMuB,gBAAN,CAAuB,EAACC,IAAIP,IAAIP,KAAT,EAAgBY,YAAhB,EAAvB,EACCD,IADD,CACM,UAACI,MAAD,EAAY;AAChBlB,gBAAQC,GAAR,CAAYiB,MAAZ;AACA,YAAIC,UAAU,EAACC,MAAM,EAAC,uBAAuBL,KAAxB,EAAP,EAAd;AACArB,kBAAU2B,MAAV,CAAiB,EAACC,KAAKZ,IAAIG,EAAV,EAAjB,EAAgCM,OAAhC,EAAyC,EAACI,KAAK,IAAN,EAAzC,EAAsD,UAACd,GAAD,EAAMC,GAAN,EAAc;AAClE,cAAID,GAAJ,EAAS;AACPT,oBAAQW,KAAR,CAAcF,IAAIG,OAAlB;AACD;AACDZ,kBAAQC,GAAR,CAAY,WAAZ;AACA,iBAAOF,GAAG,IAAH,EAASW,IAAIc,QAAJ,EAAT,CAAP;AACD,SAND;AAOD,OAXD,EAWG,UAACf,GAAD,EAAS;AACVT,gBAAQW,KAAR,CAAcF,GAAd;AACA,eAAOV,GAAGU,GAAH,CAAP;AACD,OAdD;AAeA;AACAT,cAAQW,KAAR,CAAcF,GAAd;AACA,aAAOV,GAAGU,GAAH,CAAP;AACD,KApBD,EAoBG,UAACE,KAAD,EAAW;AACZX,cAAQW,KAAR,CAAcA,KAAd;AACA,aAAOZ,GAAGY,KAAH,CAAP;AACD,KAvBD;AAwBD,GA9BD;AA+BD;;AAED,SAASc,YAAT,GAAyB,CAExB;;AAED,IAAMC,WAAW;AACfC,qBAAmB,2BAACV,EAAD,EAAKW,OAAL,EAAiB,CAEnC;AAHc,CAAjB;;AAMAC,OAAOC,OAAP,GAAiB,EAACjC,gBAAD,EAAU4B,0BAAV,EAAjB","file":"onboard.js","sourcesContent":["'use strict'\nconst {Email} = require('./mail')\nconst {Whitelist} = require('../lib/model')\nconst {confirmEmailToken, verifyToken} = require('./jsonwebtoken')\n\nfunction onBoard (data, cb) {\n  console.log('onboarding')\n  cb = cb || function () {}\n  // todo: persist whitelist\n  // var data =\n  let record = new Whitelist({\n    email: data.email,\n    ip: data.ip,\n    cryptoType: data.cryptoType,\n    purchaseAmount: data.purchaseAmount,\n    timeZone: data.timeZone\n\n  })\n  record.save((err, doc) => {\n    if (err) {\n      console.error(err.message)\n      return cb(err)\n    }\n    // todo: create token\n    confirmEmailToken(doc.id).then((token) => {\n      // todo: send email\n      Email.sendConfirmation({to: doc.email, token})\n      .then((result) => {\n        console.log(result)\n        let updates = {$set: {'meta.whitelistToken': token}}\n        Whitelist.update({_id: doc.id}, updates, {new: true}, (err, doc) => {\n          if (err) {\n            console.error(err.message)\n          }\n          console.log('onboarded')\n          return cb(null, doc.toObject())\n        })\n      }, (err) => {\n        console.error(err)\n        return cb(err)\n      })\n      // todo: update whitelist\n      console.error(err)\n      return cb(err)\n    }, (error) => {\n      console.error(error)\n      return cb(error)\n    })\n  })\n}\n\nfunction confirmEmail () {\n\n}\n\nconst Business = {\n  resendVerifyEmail: (to, context) => {\n\n  }\n}\n\nmodule.exports = {onBoard, confirmEmail}"]}