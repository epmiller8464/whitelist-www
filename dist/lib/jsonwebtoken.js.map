{"version":3,"sources":["../../lib/jsonwebtoken.js"],"names":["uuid","require","jwt","moment","TOKEN_TYPES","VERIFY_EMAIL_TOKEN","emailVerificationToken","id","Promise","resolve","reject","jwtid","v4","payload","sub","type","tgeDate","process","env","TGE_DATE","TGE_DATE_FORMAT","daysUntilTGE","diff","format","expiresId","jwtOpts","expiresIn","subject","issuer","ADMIN_EMAIL","sign","PK","e","verifyEmailVerificationToken","verify","module","exports"],"mappings":"AAAA;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,MAAMD,QAAQ,cAAR,CAAZ;AACA,IAAME,SAASF,QAAQ,QAAR,CAAf;;AAEA,IAAMG,cAAc;AAClBC,sBAAoB;AADF,CAApB;AAGA;;;;;AAKA,IAAMC,yBAAyB,SAAzBA,sBAAyB,CAAUC,EAAV,EAAc;AAC3C,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAI;AACF,UAAIC,QAAQX,KAAKY,EAAL,EAAZ;;AAEA,UAAIC,UAAU;AACZC,aAAKP,EADO;AAEZQ,cAAMX,YAAYC;AAFN,OAAd;AAIA,UAAIW,UAAUb,OAAOc,QAAQC,GAAR,CAAYC,QAAnB,EAA6BF,QAAQC,GAAR,CAAYE,eAAzC,CAAd;AACA,UAAIC,eAAeL,QAAQM,IAAR,CAAanB,SAASoB,MAAT,CAAgBN,QAAQC,GAAR,CAAYE,eAA5B,CAAb,EAA2D,MAA3D,CAAnB;AACA,UAAII,YAAeH,YAAf,MAAJ;AACA,UAAII,UAAU;AACZC,mBAAWF,SADC;AAEZb,eAAOA,KAFK;AAGZgB,iBAASpB,EAHG;AAIZqB,gBAAQX,QAAQC,GAAR,CAAYW;AAJR,OAAd;AAMA,aAAOpB,QAAQP,IAAI4B,IAAJ,CAASjB,OAAT,EAAkBI,QAAQC,GAAR,CAAYa,EAA9B,EAAkCN,OAAlC,CAAR,CAAP;AACD,KAjBD,CAiBE,OAAOO,CAAP,EAAU;AACV,aAAOtB,OAAOsB,CAAP,CAAP;AACD;AACF,GArBM,CAAP;AAsBD,CAvBD;AAwBA,IAAMC,+BAA+B,SAA/BA,4BAA+B,CAAU/B,GAAV,EAAe;AAClD,SAAO,IAAIM,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAI;AACF,aAAOD,QAAQP,IAAIgC,MAAJ,CAAWhC,GAAX,EAAgBe,QAAQC,GAAR,CAAYa,EAA5B,CAAR,CAAP;AACD,KAFD,CAEE,OAAOC,CAAP,EAAU;AACV,aAAOtB,OAAOsB,CAAP,CAAP;AACD;AACF,GANM,CAAP;AAOD,CARD;AASAG,OAAOC,OAAP,GAAiB,EAAC9B,8CAAD,EAAyB2B,0DAAzB,EAAuD7B,wBAAvD,EAAjB","file":"jsonwebtoken.js","sourcesContent":["'use strict'\nconst uuid = require('uuid')\nconst jwt = require('jsonwebtoken')\nconst moment = require('moment')\n\nconst TOKEN_TYPES = {\n  VERIFY_EMAIL_TOKEN: 'verify_email_token'\n}\n/**\n *\n * @param id\n * @returns {Promise}\n */\nconst emailVerificationToken = function (id) {\n  return new Promise(function (resolve, reject) {\n    try {\n      let jwtid = uuid.v4()\n\n      let payload = {\n        sub: id,\n        type: TOKEN_TYPES.VERIFY_EMAIL_TOKEN\n      }\n      let tgeDate = moment(process.env.TGE_DATE, process.env.TGE_DATE_FORMAT)\n      let daysUntilTGE = tgeDate.diff(moment().format(process.env.TGE_DATE_FORMAT), 'days')\n      let expiresId = `${daysUntilTGE}d`\n      let jwtOpts = {\n        expiresIn: expiresId,\n        jwtid: jwtid,\n        subject: id,\n        issuer: process.env.ADMIN_EMAIL\n      }\n      return resolve(jwt.sign(payload, process.env.PK, jwtOpts))\n    } catch (e) {\n      return reject(e)\n    }\n  })\n}\nconst verifyEmailVerificationToken = function (jwt) {\n  return new Promise(function (resolve, reject) {\n    try {\n      return resolve(jwt.verify(jwt, process.env.PK))\n    } catch (e) {\n      return reject(e)\n    }\n  })\n}\nmodule.exports = {emailVerificationToken, verifyEmailVerificationToken, TOKEN_TYPES}"]}