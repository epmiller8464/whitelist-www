{"version":3,"sources":["../../lib/jsonwebtoken.js"],"names":["uuid","require","jwt","moment","nonce","TOKEN_TYPES","VERIFY_EMAIL_TOKEN","confirmEmailToken","id","Promise","resolve","reject","jwtid","v4","payload","sub","type","tgeDate","process","env","TGE_DATE","TGE_DATE_FORMAT","daysUntilTGE","diff","format","expiresId","jwtOpts","expiresIn","issuer","ADMIN_EMAIL","sign","PK","e","verifyToken","token","verify","maxAge","tokenError","payLoad","module","exports"],"mappings":"AAAA;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,MAAMD,QAAQ,cAAR,CAAZ;AACA,IAAME,SAASF,QAAQ,QAAR,CAAf;AACA,IAAMG,QAAQH,QAAQ,OAAR,GAAd;AACA,IAAMI,cAAc;AAClBC,sBAAoB;AADF,CAApB;AAGA;;;;;AAKA,IAAMC,oBAAoB,SAApBA,iBAAoB,CAAUC,EAAV,EAAc;AACtC,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAI;AACF,UAAIC,QAAQZ,KAAKa,EAAL,EAAZ;;AAEA,UAAIC,UAAU;AACZC,aAAKP,EADO;AAEZQ,cAAMX,YAAYC,kBAFN;AAGZF,eAAOA;AAHK,OAAd;AAKA,UAAIa,UAAUd,OAAOe,QAAQC,GAAR,CAAYC,QAAnB,EAA6BF,QAAQC,GAAR,CAAYE,eAAzC,CAAd;AACA,UAAIC,eAAeL,QAAQM,IAAR,CAAapB,OAAO,EAAP,EAAWqB,MAAX,CAAkBN,QAAQC,GAAR,CAAYE,eAA9B,CAAb,EAA6D,MAA7D,CAAnB;AACA,UAAII,YAAeH,YAAf,MAAJ;AACA,UAAII,UAAU;AACZC,mBAAWF,SADC;AAEZb,eAAOA,KAFK;AAGZ;AACAgB,gBAAQV,QAAQC,GAAR,CAAYU;AAJR,OAAd;AAMA,aAAOnB,QAAQR,IAAI4B,IAAJ,CAAShB,OAAT,EAAkBI,QAAQC,GAAR,CAAYY,EAA9B,EAAkCL,OAAlC,CAAR,CAAP;AACD,KAlBD,CAkBE,OAAOM,CAAP,EAAU;AACV,aAAOrB,OAAOqB,CAAP,CAAP;AACD;AACF,GAtBM,CAAP;AAuBD,CAxBD;AAyBA;;;;;AAKA,IAAMC,cAAc,SAAdA,WAAc,CAAUC,KAAV,EAAiB;AACnC,SAAO,IAAIzB,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAI;AACF,UAAIM,UAAUd,OAAOe,QAAQC,GAAR,CAAYC,QAAnB,EAA6BF,QAAQC,GAAR,CAAYE,eAAzC,CAAd;AACA,UAAIC,eAAeL,QAAQM,IAAR,CAAapB,OAAO,EAAP,EAAWqB,MAAX,CAAkBN,QAAQC,GAAR,CAAYE,eAA9B,CAAb,EAA6D,MAA7D,CAAnB;AACA,UAAII,YAAeH,YAAf,MAAJ;AACApB,UAAIiC,MAAJ,CAAWD,KAAX,EAAkBhB,QAAQC,GAAR,CAAYY,EAA9B,EAAkC,EAACK,QAAQX,SAAT,EAAlC,EAAuD,UAACY,UAAD,EAAaC,OAAb,EAAyB;AAC9E,YAAID,UAAJ,EAAgB;AACd,iBAAO1B,OAAO0B,UAAP,CAAP;AACD;AACD,eAAO3B,QAAQ4B,OAAR,CAAP;AACD,OALD;AAMD,KAVD,CAUE,OAAON,CAAP,EAAU;AACV,aAAOrB,OAAOqB,CAAP,CAAP;AACD;AACF,GAdM,CAAP;AAeD,CAhBD;AAiBAO,OAAOC,OAAP,GAAiB,EAACjC,oCAAD,EAAoB0B,wBAApB,EAAjB","file":"jsonwebtoken.js","sourcesContent":["'use strict'\nconst uuid = require('uuid')\nconst jwt = require('jsonwebtoken')\nconst moment = require('moment')\nconst nonce = require('nonce')()\nconst TOKEN_TYPES = {\n  VERIFY_EMAIL_TOKEN: 'verify_email_token'\n}\n/**\n * @name confirmEmailToken\n * @param id {String} id of the subject\n * @returns {Promise}\n */\nconst confirmEmailToken = function (id) {\n  return new Promise(function (resolve, reject) {\n    try {\n      let jwtid = uuid.v4()\n\n      let payload = {\n        sub: id,\n        type: TOKEN_TYPES.VERIFY_EMAIL_TOKEN,\n        nonce: nonce()\n      }\n      let tgeDate = moment(process.env.TGE_DATE, process.env.TGE_DATE_FORMAT)\n      let daysUntilTGE = tgeDate.diff(moment({}).format(process.env.TGE_DATE_FORMAT), 'days')\n      let expiresId = `${daysUntilTGE}d`\n      let jwtOpts = {\n        expiresIn: expiresId,\n        jwtid: jwtid,\n        // subject: id,\n        issuer: process.env.ADMIN_EMAIL\n      }\n      return resolve(jwt.sign(payload, process.env.PK, jwtOpts))\n    } catch (e) {\n      return reject(e)\n    }\n  })\n}\n/**\n *\n * @param jwt\n * @returns {Promise}\n */\nconst verifyToken = function (token) {\n  return new Promise(function (resolve, reject) {\n    try {\n      let tgeDate = moment(process.env.TGE_DATE, process.env.TGE_DATE_FORMAT)\n      let daysUntilTGE = tgeDate.diff(moment({}).format(process.env.TGE_DATE_FORMAT), 'days')\n      let expiresId = `${daysUntilTGE}d`\n      jwt.verify(token, process.env.PK, {maxAge: expiresId}, (tokenError, payLoad) => {\n        if (tokenError) {\n          return reject(tokenError)\n        }\n        return resolve(payLoad)\n      })\n    } catch (e) {\n      return reject(e)\n    }\n  })\n}\nmodule.exports = {confirmEmailToken, verifyToken}\n"]}