{"version":3,"sources":["../../../lib/model/user.js"],"names":["mongoose","require","module","exports","moment","bcrypt","Model","UserSchema","Schema","first_name","type","String","trim","required","minLength","last_name","email","lowercase","match","unique","pwd","verified","Boolean","default","flags","ip","whitelisted","country_code","role","enum","contact","Types","Object","history","meta","timestamps","created_at","updated_at","collection","index","username","pre","next","user","isModified","isNew","genSalt","error","salt","hash","methods","comparePassword","password","cb","compare","matches","model","e"],"mappings":"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","file":"user.js","sourcesContent":["'use strict'\nvar mongoose = require('mongoose')\n// let moment = require('moment')()\n// Hey, eric miller,\n//   Please verify your email.\n//\n//\n//\n//   Verify Your Account\n// {\"consumer\":{\"UID\":\"d5f45290c28937663bffacbb08ce2a6c866472ace3b4dad3bc31d1dbdd63cc1a\"},\"device\":{\"ID\":\"02583cb73720d0f586e749cdd389bdf28f68ec591c4f7ad3376f0646e4477644aa2ab8cd17e31125435d69c09c85f190\",\"type\":\"Desktop\"},\"e2ee\":\"isAFY5cphs7zXRYYur7TwIU7V5zLFXoN4bZ8m33zpBj7U9WNhv2PSmeNevxw4tKe1EVcLwH+wr+IP7+a98uD8TYOBbunoU1sFeEWFj92ZOJd0nv1x2C8R2A4jf1O8XB4Y3y2v/HDwF7izthKeXsRuulRqHDM/5OLFGfaUjxaCGSIgdE1zDfXKj3OpWnjfe4Tyk8mslt9YbqqarccQ5l1GDUeEy9iAw7rf265jBJo57q69IdgLSDyM4jhl4hRnmZ614iUuYPZaN+3mGOi6aDE5lhX32rEtwsAQHmN5aRrtZnlhw2RsKHC+8Dnrnghfu8PczABBD9TLoxWrFe3Wg8KGphCO5+GW09fgz1uAmxnIh3m2TtC2wdkRJ5YHSN4Bdf3KIhsF8NBdaN77EH1cKQz5zOxoJevm0Xs+wOqVHv7LgWz/3UTatxvse1fAcNkSM5MDCXgb7OSUvdzLAtsget0+ItpkEDAC96rlOwjH2NUi5exgkRuF4DOoIQzVsV8mZ8XkueeaXUEj2YCR/3hcvfuHBS486TOHWD0ydV1wSudhjLYwoMdG957EdrghOckFz0SMiUS5SHtrza2df4pHpYOcTSvLtLiZYyTYbWYI1LaVhDZa2jmDag6uYil0mxTvUXq9nGoN6J3PLsTx9LWMimrvurWFweSYzjgAKvNg6htqs7+hGDcM/TjjasErN81Qq76uKAJDIbPtOUyYK01lfe9xFVzLZI7P2ZAJILpeBxjtVu8f8W3EVXZDZyfv71iq/W1Xb44i/gmWKQZaKZrxXPbDLLXYozfkNgYgow6D6X8S/3tDW8DKJ5xg243qOxIFfBNy/RIz7au+475hKvNx80Xb1+Mp93CyWvHDi9ScyBXoMfRsszDLyOHHnJsFSar2oDbUXZZO0/BmlXvA6eoQPxf9wfgEBPBkpApqEOl4sOGOSbeK4q7tCnEfphYaIAcDNU/bovyWZfXmnnAUAZoJeXBN0v4BSWglIXBUiJYRIVJDMg5AtZfniCvTM0NYn+/R1/MOWW9QpiI3IERWuIBCpLsSYA4uw870UWFf3B5EPoUdTjN2aS9UaVIHImgz3l3rY91T5TUQODz8S78yjuTa5aUdmzFQ1gvAzlvuA87wQviz6WmAL+qSNmlFrXpD2xFCXvJ+BiMTdkqFh4mqSncz6Xo2OcqG4pwm3ytHoKBngauG4FAgPrelX+47JKPP53HVbclG9JiIqJD/rdQqef4+0u3QofP25OW6fvAa13MUNROTy5/S1rfGTfL8nCq9jVjMIUKvRUNiSwjBzZu8k2Gp5IOGFFvESsXutgcRMf2sWFovCqk2hfhWPE4/MZaHxik05mNj+NDi+NmEqV3cZg+DJJYCYS8E2ACNQ4NF2eGkUKSYlMQfrc9QSpWGoS6KMOqJEQbD8dv3ZqBmIQKgjCkttHLnjO0PcghPttI1EobLL/LPO0mBrWNw2drGLWzKceggRd857pYCnlKoleDlCbF9OXAfZdeioscamaUA7ktPkZdP8Gjf42fQYlXXcRyqGxCXlTp6bbHwlk2VZOoSjNHT50XbY2HWuW7eBJXRoRjfAQz4eqo34fubJIMb6PF6FfPxC+df4rvuiOW0hcmku/ZP6gzZKbW/llKt7C8y3LnArIbs0nyU4ktPPvE8c4+sOI8ANeV2srgbmlcnQidpnD0UI5GBn36Ag0xHLxiGLB+XWV962QkFzSc8wRbZKlG/NQ9Lv8X03HrNyVwucRnISKwgGmCY5kUIZUI2xKGUuAi+igWxCPVGav/rPJ+eu3CrWc3lu98pmvpyY3wugD0oEs91pthsJW5+GGTHFIX5ANAhzH5IBdVldaxJaQi8j5Cqldqe/eoB6rg6wowWeuaRWukPDXW2MAHTZfAklLIEYmTRajkPHzIrFfgxGEg3pLaLWwTrJ46S81R0Uk9IVSLWFojdEv5+7y6hy5q75Hyfeh6f7j1n90IMTGl81zjMOPp+fC3qVoXshKEzvB0OLQxkrvF0y+GCY0hKsLBuofWoxXywzfxwDYjGTPIwr6zZq806mtEXmDQEnDk5QUZVOyLFc7NfQukxyZum0NweZyKjBttF7xGud063pPRJY0tg+Xlzp0/LcjS5COH3vGCH2imI7nfeuIlCmlkDJonbo1Gkv+EzRrCjuL/Y35oK5/0VgIFD2BA55mn/92syiSMGtOumLkZUyKNhjjzCsWZi/hFYoq1d4e1d3QWlwptjjSFQdv8Iln4F4Bv4xPtCPCaZDPxkQA80csWRINK/vUuDUEgBUpFArybu7Iq726E4G+Z0gCR7YAgOppQLeOFZM0eEPi9oO+5qA+xCp5n0TiG+Sc1BOgRTw4VqTZFAiMoi6pKdLTcno48KUW+dorkSfTFOOvKUSoJJYYaoV92syT0GXxDyjnu38tQVhDwqxiJ4HyZrsHdYE/S75VEUQzKMl/+sYmrrnDEwM4AghqCHa9QsTywZwr6rmF1l+1p6XW08HZD/O4VHp9PP/qecTNg066OCfSGQxYZ57EfVdBANWQsGkDqxye55CtxANmTPRQ51qbFLNnH4b8KePkGPx+3pAhfu6hApEUJbVd/lQ==hnKqkmA6c2Dk68Ra+2tCPw==\",\"SLT\":\"150010966755740097116541029855982339314\"}\nmodule.exports = function () {\n  const moment = require('moment')\n  const bcrypt = require('bcrypt')\n\n  let Model\n  // 'https://www.thetatoken.org/verify/\n  // 9ab52cb2-d012-11e7-aaa7-3b535aee91ce?token=9ab52c26-d012-11e7-aaa6-53ee023d7a4d\n  // &email=epmiller8464@gmail.com'\n  /* phone: {\n        phone_number: {\n          type: String,\n          trim: true,\n          required: true,\n          maxLength: 10,\n          minLength: 10,\n          match: /\\d{10}\\b/,\n          set: normalizePhoneNumber,\n          get: internationalPhoneNumber\n\n        },\n        country_code: {\n          type: String,\n          trim: true,\n          uppercase: true,\n          maxLength: 2,\n          minLength: 2,\n          required: false,\n          default: 'US'\n        },\n      }, */\n  let UserSchema = new mongoose.Schema({\n    first_name: {type: String, trim: true, required: false, minLength: 1},\n    last_name: {type: String, trim: true, required: false, minLength: 1},\n    email: {\n      type: String,\n      trim: true,\n      lowercase: true,\n      required: false,\n      minLength: 1,\n      match: /.+\\@.+\\..+/,\n      unique: true\n    },\n    pwd: {type: String, required: true},\n    verified: {type: Boolean, required: true, default: false},\n    flags: [String],\n    ip: [String],\n    whitelisted: Boolean,\n    country_code: String,\n    role: {type: String, required: true, enum: ['user', 'super-user', 'admin'], default: 'user'},\n    contact: {type: mongoose.Schema.Types.Object},\n    history: [mongoose.Schema.Types.Object],\n    meta: {type: mongoose.Schema.Types.Object}\n  }, {timestamps: {created_at: 'created_at', updated_at: 'updated_at'}}, {collection: 'user'})\n\n  UserSchema.index({username: 1})\n  UserSchema.index({email: 1})\n\n  UserSchema.pre('save', function (next) {\n    const user = this\n    if (this.isModified('password') || this.isNew) {\n      bcrypt.genSalt(10, (error, salt) => {\n        if (error) return next(error)\n        bcrypt.hash(user.pwd, salt, (error, hash) => {\n          if (error) return next(error)\n          user.pwd = hash\n          next()\n        })\n      })\n    } else {\n      return next()\n    }\n  })\n\n  UserSchema.methods.comparePassword = function (password, cb) {\n    bcrypt.compare(password, this.pwd, (error, matches) => {\n      if (error) {\n        return cb(error)\n      }\n      return cb(null, matches)\n    })\n  }\n  try {\n    // Throws an error if \"Name\" hasn't been registered\n    Model = mongoose.model('user')\n  } catch (e) {\n    Model = mongoose.model('user', UserSchema)\n  }\n  return Model\n}\n"]}