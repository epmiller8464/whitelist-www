{"version":3,"sources":["../../../lib/model/whitelist.js"],"names":["mongoose","require","Schema","encrypt","decrypt","module","exports","moment","whitelistSchema","email","type","String","trim","lowercase","required","minLength","get","v","set","ip","purchaseAmount","cryptoType","country","usCitizenAttestation","Boolean","default","canParticipate","verified","createDate","Date","utc","epoch","Number","now","token","jwt","unique","blackListed","revoked","timeZone","ts","zoneName","offset","meta","Types","Object","collection","getters","index","sparse","Model","model","e"],"mappings":"AAAA;;AAEA,IAAIA,WAAWC,QAAQ,UAAR,CAAf;AACA,IAAIC,SAASF,SAASE,MAAtB;;eAC2BD,QAAQ,WAAR,C;IAApBE,O,YAAAA,O;IAASC,O,YAAAA,O;;AAChBC,OAAOC,OAAP,GAAiB,YAAY;AAC3B,MAAMC,SAASN,QAAQ,QAAR,CAAf;AACA;AACA,MAAIO,kBAAkB,IAAIN,MAAJ,CAAW;AAC/BO,WAAO;AACLC,YAAMC,MADD;AAELC,YAAM,IAFD;AAGL;AACAC,iBAAW,IAJN;AAKLC,gBAAU,IALL;AAMLC,iBAAW,CANN;AAOLC,WAAK,aAACC,CAAD,EAAO;AAAE,eAAOb,QAAQa,CAAR,CAAP;AAAmB,OAP5B;AAQLC,WAAK;AAAA,eAAKf,QAAQc,CAAR,CAAL;AAAA;AARA,KADwB;AAW/BE,QAAI,EAACT,MAAMC,MAAP,EAX2B;AAY/BS,oBAAgB,EAACV,MAAMC,MAAP,EAAeK,KAAK,aAACC,CAAD,EAAO;AAAE,eAAOb,QAAQa,CAAR,CAAP;AAAmB,OAAhD,EAAkDC,KAAK;AAAA,eAAKf,QAAQc,CAAR,CAAL;AAAA,OAAvD,EAZe;AAa/BI,gBAAY,EAACX,MAAMC,MAAP,EAbmB;AAc/BW,aAASX,MAdsB;AAe/BY,0BAAsB,EAACb,MAAMc,OAAP,EAAgBC,SAAS,KAAzB,EAAgCX,UAAU,IAA1C,EAfS;AAgB/BY,oBAAgB,EAAChB,MAAMc,OAAP,EAAgBC,SAAS,IAAzB,EAA+BX,UAAU,IAAzC,EAhBe;AAiB/Ba,cAAU,EAACjB,MAAMc,OAAP,EAAgBC,SAAS,KAAzB,EAAgCX,UAAU,IAA1C,EAjBqB;AAkB/Bc,gBAAY,EAAClB,MAAMmB,IAAP,EAAaJ,SAASlB,OAAOuB,GAA7B,EAAkChB,UAAU,IAA5C,EAlBmB;AAmB/BiB,WAAO,EAACrB,MAAMsB,MAAP,EAAeP,SAASI,KAAKI,GAA7B,EAAkCnB,UAAU,IAA5C,EAnBwB;AAoB/BoB,WAAO;AACLC,WAAK,EAACzB,MAAMC,MAAP,EAAeyB,QAAQ,IAAvB,EADA;AAELC,mBAAa,EAAC3B,MAAMc,OAAP,EAAgBC,SAAS,KAAzB,EAFR;AAGLa,eAAS,EAAC5B,MAAMc,OAAP,EAAgBC,SAAS,KAAzB;AAHJ,KApBwB;AAyB/Bc,cAAU;AACRC,UAAI7B,MADI;AAER8B,gBAAU9B,MAFF;AAGR+B,cAAQ/B;AAHA,KAzBqB;AA8B/BgC,UAAM,EAACjC,MAAMV,SAASE,MAAT,CAAgB0C,KAAhB,CAAsBC,MAA7B;AA9ByB,GAAX,EA+BnB,EAACC,YAAY,WAAb,EA/BmB,CAAtB;AAgCAtC,kBAAgBU,GAAhB,CAAoB,UAApB,EAAgC,EAAC6B,SAAS,IAAV,EAAhC;AACAvC,kBAAgBwC,KAAhB,CAAsB,EAAC,SAAS,CAAV,EAAtB,EAAoC,EAACC,QAAQ,CAAT,EAApC;AACA;AACAzC,kBAAgBwC,KAAhB,CAAsB,EAAC7B,IAAI,CAAL,EAAtB;AACA,MAAI+B,cAAJ;AACA,MAAI;AACF;AACAA,YAAQlD,SAASmD,KAAT,CAAe,WAAf,CAAR;AACD,GAHD,CAGE,OAAOC,CAAP,EAAU;AACVF,YAAQlD,SAASmD,KAAT,CAAe,WAAf,EAA4B3C,eAA5B,CAAR;AACD;AACD,SAAO0C,KAAP;AACD,CA/CD","file":"whitelist.js","sourcesContent":["'use strict'\n\nvar mongoose = require('mongoose')\nvar Schema = mongoose.Schema\nconst {encrypt, decrypt} = require('../crypto')\nmodule.exports = function () {\n  const moment = require('moment')\n  // let moment = require('moment')\n  let whitelistSchema = new Schema({\n    email: {\n      type: String,\n      trim: true,\n      // unique: true,\n      lowercase: true,\n      required: true,\n      minLength: 1,\n      get: (v) => { return decrypt(v) },\n      set: v => encrypt(v)\n    },\n    ip: {type: String},\n    purchaseAmount: {type: String, get: (v) => { return decrypt(v) }, set: v => encrypt(v)},\n    cryptoType: {type: String},\n    country: String,\n    usCitizenAttestation: {type: Boolean, default: false, required: true},\n    canParticipate: {type: Boolean, default: true, required: true},\n    verified: {type: Boolean, default: false, required: true},\n    createDate: {type: Date, default: moment.utc, required: true},\n    epoch: {type: Number, default: Date.now, required: true},\n    token: {\n      jwt: {type: String, unique: true},\n      blackListed: {type: Boolean, default: false},\n      revoked: {type: Boolean, default: false}\n    },\n    timeZone: {\n      ts: String,\n      zoneName: String,\n      offset: String\n    },\n    meta: {type: mongoose.Schema.Types.Object}\n  }, {collection: 'whitelist'})\n  whitelistSchema.set('toObject', {getters: true})\n  whitelistSchema.index({'token': 1}, {sparse: 1})\n  // whitelistSchema.index({jwtid: 1}, {unique: true})\n  whitelistSchema.index({ip: 1})\n  let Model\n  try {\n    // Throws an error if \"Name\" hasn't been registered\n    Model = mongoose.model('whitelist')\n  } catch (e) {\n    Model = mongoose.model('whitelist', whitelistSchema)\n  }\n  return Model\n}\n"]}