{"version":3,"sources":["../../lib/mail.js"],"names":["sgMail","require","buildUrl","setApiKey","process","env","SENDGRID_API_KEY","Email","to","token","console","log","substitutions","confirm_url","discount","TGE_PERCENT_DISCOUNT","Promise","resolve","reject","send","personalizations","email","substitutionWrappers","from","NOREPLY_EMAIL","name","template_id","subject","then","module","exports"],"mappings":"AAAA;;;;;;AACA,IAAMA,SAASC,QAAQ,gBAAR,CAAf;;eACmBA,QAAQ,WAAR,C;IAAZC,Q,YAAAA,Q;AACP;;;AACAF,OAAOG,SAAP,CAAiBC,QAAQC,GAAR,CAAYC,gBAA7B;;AAEA;;;;IAGMC,K;;;;;;;;AACJ;;;;;;;AAOA;AACA;;2CAEsC;AAAA,UAAZC,EAAY,QAAZA,EAAY;AAAA,UAARC,KAAQ,QAARA,KAAQ;;AACpCC,cAAQC,GAAR,CAAY,4BAAZ;AACA,UAAIC,gBAAgB;AAClBC,qBAAaX,+BAA6BO,KAA7B,CADK;AAElBK,kBAAaV,QAAQC,GAAR,CAAYU,oBAAzB;AAFkB,OAApB;AAIA,aAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5ClB,eAAOmB,IAAP,CAAY;AACVC,4BAAkB,CAAC;AACjBZ,gBAAI,CAAC;AACHa,qBAAOb;AADJ,aAAD,CADa;AAIjBc,kCAAsB,CAAC,IAAD,EAAO,IAAP,CAJL;AAKjBV,2BAAeA;AALE,WAAD,CADR;AAQVW,gBAAM,EAACF,OAAOjB,QAAQC,GAAR,CAAYmB,aAApB,EAAmCC,MAAM,aAAzC,EARI;AASVC,uBAAa,sCATH;AAUVC,mBAAS;AAVC,SAAZ,EAWGC,IAXH,CAWQX,OAXR,EAWiBC,MAXjB;AAYD,OAbM,CAAP;AAcD;;;sDAC+C;AAAA,UAAZV,EAAY,SAAZA,EAAY;AAAA,UAARC,KAAQ,SAARA,KAAQ;;AAC9CC,cAAQC,GAAR,CAAY,uBAAZ;AACA,UAAIC,gBAAgB;AAClBC,qBAAaX;AADK,OAApB;AAGA,aAAO,IAAIc,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5ClB,eAAOmB,IAAP,CAAY;AACVC,4BAAkB,CAAC;AACjBZ,gBAAI,CAAC;AACHa,qBAAOb;AADJ,aAAD,CADa;AAIjBc,kCAAsB,CAAC,IAAD,EAAO,IAAP,CAJL;AAKjBV,2BAAeA;AALE,WAAD,CADR;AAQVW,gBAAM,EAACF,OAAOjB,QAAQC,GAAR,CAAYmB,aAApB,EAAmCC,MAAM,aAAzC,EARI;AASVC,uBAAa,sCATH;AAUVC,mBAAS;AAVC,SAAZ,EAWGC,IAXH,CAWQX,OAXR,EAWiBC,MAXjB;AAYD,OAbM,CAAP;AAcD;;;;;;AAGHW,OAAOC,OAAP,GAAiB,EAACvB,YAAD,EAAjB","file":"mail.js","sourcesContent":["'use strict'\nconst sgMail = require('@sendgrid/mail')\nconst {buildUrl} = require('./utility')\n// url.format()\nsgMail.setApiKey(process.env.SENDGRID_API_KEY)\n\n/**\n * @name Email {Email}\n */\nclass Email {\n  /**\n   * @name sendConfirmation Sends the confirmation email to a user\n   * @param to {String} email address\n   * @param name {String} name of the person receiving the email\n   * @returns {Promise}\n   */\n\n  // x-session-token:87ae6159f16d47efb60b7408673726e7\n  // x-user-id:9ab52cb2-d012-11e7-aaa7-3b535aee91ce\n\n  static sendConfirmation ({to, token}) {\n    console.log('sending confirmation email')\n    let substitutions = {\n      confirm_url: buildUrl(`verify/:id?token=${token}`),\n      discount: `${process.env.TGE_PERCENT_DISCOUNT}%`\n    }\n    return new Promise(function (resolve, reject) {\n      sgMail.send({\n        personalizations: [{\n          to: [{\n            email: to\n          }],\n          substitutionWrappers: ['{{', '}}'],\n          substitutions: substitutions\n        }],\n        from: {email: process.env.NOREPLY_EMAIL, name: 'Swytch Team'},\n        template_id: 'a05a4c7a-abec-433c-9434-ce837a8defbf',\n        subject: '⚡⚡ Swytch Token - Verify Your Email ⚡⚡'\n      }).then(resolve, reject)\n    })\n  }\n  static sendNewsletterWelcomeEmail ({to, token}) {\n    console.log('sending welcome email')\n    let substitutions = {\n      confirm_url: buildUrl(`marketing/newsletter/join`),\n    }\n    return new Promise(function (resolve, reject) {\n      sgMail.send({\n        personalizations: [{\n          to: [{\n            email: to\n          }],\n          substitutionWrappers: ['{{', '}}'],\n          substitutions: substitutions\n        }],\n        from: {email: process.env.NOREPLY_EMAIL, name: 'Swytch Team'},\n        template_id: '12226325-e3fe-45aa-a8ea-e9b33a7c5589',\n        subject: '⚡⚡ Swytch Token - Welcome to our mailing list ⚡⚡'\n      }).then(resolve, reject)\n    })\n  }\n}\n\nmodule.exports = {Email}\n"]}