{"version":3,"sources":["../../lib/mail.js"],"names":["sgMail","require","buildUrl","setApiKey","process","env","SENDGRID_API_KEY","Email","id","to","token","name","console","log","substitutions","confirm_url","Promise","resolve","reject","send","personalizations","email","substitutionWrappers","from","NOREPLY_EMAIL","template_id","subject","then","module","exports"],"mappings":"AAAA;;;;;;AACA,IAAMA,SAASC,QAAQ,gBAAR,CAAf;;eACmBA,QAAQ,WAAR,C;IAAZC,Q,YAAAA,Q;AACP;;;AACAF,OAAOG,SAAP,CAAiBC,QAAQC,GAAR,CAAYC,gBAA7B;;AAEA;;;;IAGMC,K;;;;;;;;AACJ;;;;;;;AAOA;AACA;;2CAEgD;AAAA,UAAtBC,EAAsB,QAAtBA,EAAsB;AAAA,UAAlBC,EAAkB,QAAlBA,EAAkB;AAAA,UAAdC,KAAc,QAAdA,KAAc;AAAA,UAAPC,IAAO,QAAPA,IAAO;;AAC9CC,cAAQC,GAAR,CAAY,4BAAZ;AACA,UAAIC,gBAAgB;AAClBC,qBAAab,gCAA8BQ,KAA9B,CADK;AAElBC,cAAMA;AAFY,OAApB;AAIA,aAAO,IAAIK,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5ClB,eAAOmB,IAAP,CAAY;AACVC,4BAAkB,CAAC;AACjBX,gBAAI,CAAC;AACHY,qBAAOZ,EADJ;AAEHE,oBAAMA;AAFH,aAAD,CADa;AAKjBW,kCAAsB,CAAC,IAAD,EAAO,IAAP,CALL;AAMjBR,2BAAeA;AANE,WAAD,CADR;AASVS,gBAAM,EAACF,OAAOjB,QAAQC,GAAR,CAAYmB,aAApB,EAAmCb,MAAM,aAAzC,EATI;AAUVc,uBAAa,sCAVH;AAWVC,mBAAS;AAXC,SAAZ,EAYGC,IAZH,CAYQV,OAZR,EAYiBC,MAZjB;AAaD,OAdM,CAAP;AAeD;;;sDAE+C;AAAA,UAAZT,EAAY,SAAZA,EAAY;AAAA,UAARC,KAAQ,SAARA,KAAQ;;AAC9CE,cAAQC,GAAR,CAAY,uBAAZ;AACA,UAAIC,gBAAgB;AAClBC,qBAAab;AADK,OAApB;AAGA,aAAO,IAAIc,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5ClB,eAAOmB,IAAP,CAAY;AACVC,4BAAkB,CAAC;AACjBX,gBAAI,CAAC;AACHY,qBAAOZ;AADJ,aAAD,CADa;AAIjBa,kCAAsB,CAAC,IAAD,EAAO,IAAP,CAJL;AAKjBR,2BAAeA;AALE,WAAD,CADR;AAQVS,gBAAM,EAACF,OAAOjB,QAAQC,GAAR,CAAYmB,aAApB,EAAmCb,MAAM,aAAzC,EARI;AASVc,uBAAa,sCATH;AAUVC,mBAAS;AAVC,SAAZ,EAWGC,IAXH,CAWQV,OAXR,EAWiBC,MAXjB;AAYD,OAbM,CAAP;AAcD;;;;;;AAGHU,OAAOC,OAAP,GAAiB,EAACtB,YAAD,EAAjB","file":"mail.js","sourcesContent":["'use strict'\nconst sgMail = require('@sendgrid/mail')\nconst {buildUrl} = require('./utility')\n// url.format()\nsgMail.setApiKey(process.env.SENDGRID_API_KEY)\n\n/**\n * @name Email {Email}\n */\nclass Email {\n  /**\n   * @name sendConfirmation Sends the confirmation email to a user\n   * @param to {String} email address\n   * @param name {String} name of the person receiving the email\n   * @returns {Promise}\n   */\n\n  // x-session-token:87ae6159f16d47efb60b7408673726e7\n  // x-user-id:9ab52cb2-d012-11e7-aaa7-3b535aee91ce\n\n  static sendConfirmation ({id, to, token, name}) {\n    console.log('sending confirmation email')\n    let substitutions = {\n      confirm_url: buildUrl(`verify/:id/?token=${token}`),\n      name: name\n    }\n    return new Promise(function (resolve, reject) {\n      sgMail.send({\n        personalizations: [{\n          to: [{\n            email: to,\n            name: name\n          }],\n          substitutionWrappers: ['{{', '}}'],\n          substitutions: substitutions\n        }],\n        from: {email: process.env.NOREPLY_EMAIL, name: 'Swytch Team'},\n        template_id: 'a05a4c7a-abec-433c-9434-ce837a8defbf',\n        subject: '⚡⚡ Swytch Token - Verify Your Email ⚡⚡'\n      }).then(resolve, reject)\n    })\n  }\n\n  static sendNewsletterWelcomeEmail ({to, token}) {\n    console.log('sending welcome email')\n    let substitutions = {\n      confirm_url: buildUrl(`marketing/newsletter/join`),\n    }\n    return new Promise(function (resolve, reject) {\n      sgMail.send({\n        personalizations: [{\n          to: [{\n            email: to\n          }],\n          substitutionWrappers: ['{{', '}}'],\n          substitutions: substitutions\n        }],\n        from: {email: process.env.NOREPLY_EMAIL, name: 'Swytch Team'},\n        template_id: '12226325-e3fe-45aa-a8ea-e9b33a7c5589',\n        subject: '⚡⚡ Swytch Token - Welcome to our mailing list ⚡⚡'\n      }).then(resolve, reject)\n    })\n  }\n}\n\nmodule.exports = {Email}\n"]}