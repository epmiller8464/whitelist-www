{"version":3,"sources":["../../lib/app.js"],"names":["publicIp","require","Alert","DateTime","vm","token","resetRecaptcha","$","prop","addClass","grecaptcha","reset","clearForm","removeClass","val","verified","cb","_token","data","serializeArray","hasError","json","i","length","value","name","Error","App","geoLocate","v4","then","ip","catch","e","validateForm","email","amount","cryptoCurrency","regex","RegExp","isValid","trim","test","parent","parents","submit","err","dt","local","ajax","method","url","done","result","css","targetId","message","error","fail","console","always","recaptchaCallback","window","module","exports"],"mappings":"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","file":"app.js","sourcesContent":["'use strict'\nconst publicIp = require('public-ip')\nconst Alert = require('./vanishingAlert')\nconst {DateTime} = require('luxon')\n\nlet vm = {token: null}\n\nfunction resetRecaptcha () {\n  $('#submit').prop('disabled', true)\n  $('#submit').addClass('hide')\n  vm.token = null\n  grecaptcha.reset()\n}\n\nfunction clearForm () {\n  resetRecaptcha()\n  $('.has-error').removeClass('has-error')\n  $('input[name=email]').val('')\n  $('select[name=purchaseAmount]').prop('selectedIndex', 0)\n  $('input[name=cryptoType]:checked').prop('checked', false)\n}\n\nfunction verified (token, cb) {\n  var _token = token\n  var data = $('#whitelist-form').serializeArray()\n  var hasError = false\n  var json = {}\n  for (var i = 0; i < data.length; i++) {\n    if (!data[i].value) {\n      $('#whitelist-form').addClass('has-error')\n      hasError = true\n    } else {\n      if (data[i].name === 'g-recaptcha-response') {\n        hasError = data[i].value !== _token\n      }\n    }\n    json[data[i].name] = data[i].value\n  }\n\n  if (hasError) {\n    return cb(new Error('validation failed'))\n  }\n  return cb(null, data)\n}\n\nconst App = {\n  geoLocate: function (cb) {\n    publicIp.v4().then(function (ip) {\n      return cb(null, ip)\n    })\n    .catch(function (e) {\n      return cb(e, null)\n    })\n  },\n  validateForm: function () {\n    $('.has-error').removeClass('has-error')\n    var email = $('input[name=email]').val(),\n      amount = $('select[name=purchaseAmount]').val(),\n      cryptoCurrency = $('input[name=cryptoType]:checked').val(),\n      regex = new RegExp(/.+\\@.+\\..+/),\n      isValid = true\n\n    email = (email && email.length > 0) ? email.trim() : null\n    cryptoCurrency = (cryptoCurrency && cryptoCurrency.length > 0) ? cryptoCurrency.trim() : null\n\n    if ((!email) || !regex.test(email)) {\n      $('input[name=email]').parent('.form-group').addClass('has-error')\n      isValid = false\n    }\n\n    if ((!cryptoCurrency)) {\n      $('input[name=cryptoType]').parents('.form-group').addClass('has-error')\n      isValid = false\n    }\n    if (amount === 'null') {\n      $('select[name=purchaseAmount]').parent('.form-group').addClass('has-error')\n      isValid = false\n    }\n    return isValid\n  },\n  submit: function () {\n    if (!App.validateForm() || !vm.token) {\n      // alert('ready')\n      resetRecaptcha()\n      return false\n    }\n    try {\n      verified(vm.token, function (err, data) {\n        if (err) {\n          vm.token = null\n          resetRecaptcha()\n          return false\n\n        } else {\n          $('body').addClass('loading')\n          // $('#submit').prop('disabled', true)\n          let dt = DateTime.local()\n\n          $.ajax({\n            method: 'POST',\n            url: '/whitelist',\n            data: data\n          }).done(function (result) {\n            var data = {\n              css: 'alert-success',\n              targetId: 'alert',\n              message: 'Congrats you have been added to the Swytch Whitelist.'\n            }\n            if (result.error) {\n              data.message = 'alert-danger'\n              data.message = result.error\n            }\n            Alert(data)\n          }).fail(function (e) {\n            console.error('Submission error')\n            Alert({\n              css: 'alert-danger',\n              targetId: 'alert',\n              message: 'Opps, something went wrong and we are working to resolve the issue'\n            })\n          }).always(function () {\n            $('body').removeClass('loading')\n            clearForm()\n          })\n        }\n      })\n    } catch (e) {\n      console.error('Unhandled Exception')\n      Alert({})\n      return false\n    }\n    return false\n  },\n  recaptchaCallback: function (token) {\n    // vm.token = null\n    if (!App.validateForm()) {\n      resetRecaptcha()\n      return\n    }\n    vm.token = token\n    $('#submit').prop('disabled', false)\n    $('#submit').removeClass('hide')\n  },\n  Alert: Alert\n}\nwindow.App = window.App || App\nmodule.exports = App\n"]}