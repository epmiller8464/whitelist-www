{"version":3,"sources":["../../lib/passport.js"],"names":["LocalStrategy","require","Strategy","User","module","exports","passport","use","usernameField","passwordField","username","password","done","findOne","err","user","message","comparePassword","toObject","serializeUser","id","deserializeUser","findById"],"mappings":"AAAA;;AACA,IAAMA,gBAAgBC,QAAQ,gBAAR,EAA0BC,QAAhD;;eACeD,QAAQ,SAAR,C;IAARE,I,YAAAA,I;;AAEPC,OAAOC,OAAP,GAAiB,UAACC,QAAD,EAAc;AAC7BA,WAASC,GAAT,CAAa,IAAIP,aAAJ,CAAkB,EAACQ,eAAe,OAAhB,EAAyBC,eAAe,KAAxC,EAAlB,EACX,UAAUC,QAAV,EAAoBC,QAApB,EAA8BC,IAA9B,EAAoC;AAClCT,SAAKU,OAAL,CAAa,EAACH,UAAUA,QAAX,EAAb,EAAmC,UAAUI,GAAV,EAAeC,IAAf,EAAqB;AACtD,UAAID,GAAJ,EAAS;AAAE,eAAOF,KAAKE,GAAL,CAAP;AAAkB;AAC7B,UAAI,CAACC,IAAL,EAAW;AACT,eAAOH,KAAK,IAAL,EAAW,KAAX,EAAkB,EAACI,SAAS,qBAAV,EAAlB,CAAP;AACD;AACD,UAAI,CAACD,KAAKE,eAAL,CAAqBN,QAArB,CAAL,EAAqC;AACnC,eAAOC,KAAK,IAAL,EAAW,KAAX,EAAkB,EAACI,SAAS,qBAAV,EAAlB,CAAP;AACD;AACD,aAAOJ,KAAK,IAAL,EAAWG,KAAKG,QAAL,EAAX,CAAP;AACD,KATD;AAUD,GAZU,CAAb;AAcAZ,WAASa,aAAT,CAAuB,UAAUJ,IAAV,EAAgBH,IAAhB,EAAsB;AAC3CA,SAAK,IAAL,EAAWG,KAAKK,EAAhB;AACD,GAFD;;AAIAd,WAASe,eAAT,CAAyB,UAAUD,EAAV,EAAcR,IAAd,EAAoB;AAC3CT,SAAKmB,QAAL,CAAcF,EAAd,EAAkB,UAAUN,GAAV,EAAeC,IAAf,EAAqB;AACrCH,WAAKE,GAAL,EAAUC,IAAV;AACD,KAFD;AAGD,GAJD;AAKD,CAxBD","file":"passport.js","sourcesContent":["'use strict'\nconst LocalStrategy = require('passport-local').Strategy\nconst {User} = require('./model')\n\nmodule.exports = (passport) => {\n  passport.use(new LocalStrategy({usernameField: 'email', passwordField: 'pwd'},\n    function (username, password, done) {\n      User.findOne({username: username}, function (err, user) {\n        if (err) { return done(err) }\n        if (!user) {\n          return done(null, false, {message: 'Incorrect username.'})\n        }\n        if (!user.comparePassword(password)) {\n          return done(null, false, {message: 'Incorrect password.'})\n        }\n        return done(null, user.toObject())\n      })\n    }\n  ))\n  passport.serializeUser(function (user, done) {\n    done(null, user.id)\n  })\n\n  passport.deserializeUser(function (id, done) {\n    User.findById(id, function (err, user) {\n      done(err, user)\n    })\n  })\n}\n"]}