{"version":3,"sources":["../../routes/marketing.js"],"names":["express","require","router","Router","check","validationResult","sanitize","Subscriber","Email","validate","isEmail","withMessage","trim","normalizeEmail","post","req","res","next","errors","isEmpty","status","json","mapped","create","email","body","subscribedTo","err","doc","success","message","sendNewsletterWelcomeEmail","to","then","result","catch","module","exports"],"mappings":"AAAA;;AACA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;;eACkCF,QAAQ,yBAAR,C;IAA3BG,K,YAAAA,K;IAAOC,gB,YAAAA,gB;;gBACKJ,QAAQ,0BAAR,C;IAAZK,Q,aAAAA,Q;;gBACcL,QAAQ,cAAR,C;IAAdM,U,aAAAA,U;;gBACSN,QAAQ,aAAR,C;IAATO,K,aAAAA,K;AACP;;AAEA,IAAMC,WAAW,CAACL,MAAM,OAAN,EAAeM,OAAf,GAAyBC,WAAzB,CAAqC,kBAArC,EAAyDC,IAAzD,GAAgEC,cAAhE,EAAD,EAAmFP,SAAS,OAAT,EAAkBM,IAAlB,GAAyBC,cAAzB,EAAnF,CAAjB;;AAEAX,OAAOY,IAAP,CAAY,kBAAZ,EAAgCL,QAAhC,EAA0C,UAAUM,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAClE,MAAMC,SAASb,iBAAiBU,GAAjB,CAAf;AACA,MAAI,CAACG,OAAOC,OAAP,EAAL,EAAuB;AACrB,WAAOH,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACH,QAAQA,OAAOI,MAAP,EAAT,EAArB,CAAP;AACD;AACDf,aAAWgB,MAAX,CAAkB,EAACC,OAAOT,IAAIU,IAAJ,CAASD,KAAjB,EAAwBE,cAAc,CAAC,aAAD,CAAtC,EAAlB,EAA0E,UAACC,GAAD,EAAMC,GAAN,EAAc;AACtF,QAAID,GAAJ,EAAS;AACP,aAAOX,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACQ,SAAS,KAAV,EAAiBC,SAAS,oCAA1B,EAArB,CAAP;AACD;AACDtB,UAAMuB,0BAAN,CAAiC,EAACC,IAAIjB,IAAIU,IAAJ,CAASD,KAAd,EAAjC,EACCS,IADD,CACM,UAACC,MAAD,EAAY;AAChBlB,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACQ,SAAS,IAAV,EAArB;AACD,KAHD,EAGGM,KAHH,CAGS,UAACR,GAAD,EAAS;AAChBX,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACQ,SAAS,KAAV,EAArB;AACD,KALD;AAMD,GAVD;AAWD,CAhBD;AAiBAO,OAAOC,OAAP,GAAiBnC,MAAjB","file":"marketing.js","sourcesContent":["'use strict'\nconst express = require('express')\nconst router = express.Router()\nconst {check, validationResult} = require('express-validator/check')\nconst {sanitize} = require('express-validator/filter')\nconst {Subscriber} = require('../lib/model')\nconst {Email} = require('../lib/mail')\n/* GET home page. */\n\nconst validate = [check('email').isEmail().withMessage('must be an email').trim().normalizeEmail(), sanitize('email').trim().normalizeEmail()]\n\nrouter.post('/newsletter/join', validate, function (req, res, next) {\n  const errors = validationResult(req)\n  if (!errors.isEmpty()) {\n    return res.status(422).json({errors: errors.mapped()})\n  }\n  Subscriber.create({email: req.body.email, subscribedTo: ['news-letter']}, (err, doc) => {\n    if (err) {\n      return res.status(200).json({success: false, message: 'Your e-mail is already subscribed.'})\n    }\n    Email.sendNewsletterWelcomeEmail({to: req.body.email})\n    .then((result) => {\n      res.status(200).json({success: true})\n    }).catch((err) => {\n      res.status(200).json({success: false})\n    })\n  })\n})\nmodule.exports = router\n"]}