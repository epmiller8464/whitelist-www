{"version":3,"sources":["../routes.js"],"names":["cors","require","express","csurf","authenticate","passport","module","exports","app","apiApp","disable","set","user","use","req","res","next","err","Error","status","get","json","error","message","marketing","cookie","locals","_csrfToken","csrfToken","index","tokensale","render"],"mappings":"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","file":"routes.js","sourcesContent":["'use strict'\nconst cors = require('cors')\nconst express = require('express')\n\nconst csurf = require('csurf')\nconst authenticate = require('./lib/authenticate')\nconst passport = require('passport')\nmodule.exports = function (app) {\n  var apiApp = express()\n  // apiApp.use(sslRedirect());\n  apiApp.disable('x-powered-by')\n\n  // var Api = require('./routes/api')\n  // apiApp.use(PATH, require('cors')({\n  //   origin: '*',\n  //   methods: 'GET,PUT,POST,DELETE',\n  //   headers: ['Content-Type', 'Authorization']\n  // }))\n\n  apiApp.set('trust proxy', 1)\n  const user = require('./routes/api/user')\n  apiApp.use('/api/v1/users', user)\n\n  apiApp.use('/api/v1', function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    // req.log.error(err)\n    next(err)\n  })\n\n  if (apiApp.get('env') === 'development') {\n    apiApp.use('/api/v1', function (err, req, res, next) {\n      res.status(err.status || 500).json({error: true, message: err.message})\n    })\n  } else {\n    apiApp.use('/api/v1', function (err, req, res, next) {\n      res.status(err.status || 500).json({error: true, message: err.message})\n    })\n  }\n\n  app.use(apiApp)\n  app.disable('x-powered-by')\n  app.use(cors())\n  app.set('trust proxy', 1)\n\n  const marketing = require('./routes/marketing')\n  app.use('/marketing', marketing)\n  // /marketing/newsletter/join\n  app.use('/', csurf({cookie: true}))\n  // let authorize = require('./lib/authorization')\n  app.use('/', function (req, res, next) {\n    res.locals._csrfToken = req.csrfToken()\n    // res.locals.user = {user: req.user}\n    next()\n  })\n  const index = require('./routes/index')\n  app.use('/', index)\n  // const platform = require('./routes/platform')\n  // app.use('/platform', authenticate, platform)\n  const tokensale = require('./routes/tokensale')\n  app.use('/token-sale', authenticate, tokensale)\n\n  app.use(function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    next(err)\n  })\n\n// error handler\n  app.use(function (err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message\n    res.locals.error = req.app.get('env') === 'development' ? err : {}\n\n    // render the error page\n    res.status(err.status || 500)\n    res.render('error')\n  })\n\n}"]}