{"version":3,"sources":["../routes.js"],"names":["cors","require","express","csurf","authenticate","passport","module","exports","app","apiApp","disable","set","user","use","auth","req","res","next","err","Error","status","get","json","error","message","marketing","cookie","locals","_csrfToken","csrfToken","index","render"],"mappings":"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","file":"routes.js","sourcesContent":["'use strict'\nconst cors = require('cors')\nconst express = require('express')\n\nconst csurf = require('csurf')\nconst authenticate = require('./lib/authenticate')\nconst passport = require('passport')\nmodule.exports = function (app) {\n  var apiApp = express()\n  // apiApp.use(sslRedirect());\n  apiApp.disable('x-powered-by')\n\n  // var Api = require('./routes/api')\n  // apiApp.use(PATH, require('cors')({\n  //   origin: '*',\n  //   methods: 'GET,PUT,POST,DELETE',\n  //   headers: ['Content-Type', 'Authorization']\n  // }))\n\n  apiApp.set('trust proxy', 1)\n  const user = require('./routes/api/user')\n  apiApp.use('/api/v1/users', user)\n\n  const auth = require('./routes/api/auth')\n  apiApp.use('/api/v1/auth', auth)\n\n  apiApp.use('/api/v1', function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    // req.log.error(err)\n    next(err)\n  })\n\n  if (apiApp.get('env') === 'development') {\n    apiApp.use('/api/v1', function (err, req, res, next) {\n      res.status(err.status || 500).json({error: true, message: err.message})\n    })\n  } else {\n    apiApp.use('/api/v1', function (err, req, res, next) {\n      res.status(err.status || 500).json({error: true, message: err.message})\n    })\n  }\n\n  app.use(apiApp)\n  app.disable('x-powered-by')\n  app.use(cors())\n  app.set('trust proxy', 1)\n\n  const marketing = require('./routes/marketing')\n  app.use('/marketing', marketing)\n  // let platform = require('./platform')()\n  app.use(require('./platform')())\n  // /marketing/newsletter/join\n  app.use('/', csurf({cookie: true}))\n  // let authorize = require('./lib/authorization')\n  app.use('/', function (req, res, next) {\n    res.locals._csrfToken = req.csrfToken()\n    // res.locals.user = {user: req.user}\n    next()\n  })\n  const index = require('./routes/index')\n  app.use('/', index)\n\n  app.use(function (req, res, next) {\n    var err = new Error('Not Found')\n    err.status = 404\n    next(err)\n  })\n\n// error handler\n  app.use(function (err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message\n    res.locals.error = req.app.get('env') === 'development' ? err : {}\n\n    // render the error page\n    res.status(err.status || 500)\n    res.render('error')\n  })\n\n}"]}